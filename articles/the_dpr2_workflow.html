<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The DPR2 Workflow • DPR2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The DPR2 Workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DPR2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction_to_dpr2.html">Introduction to DPR2</a></li>
    <li><a class="dropdown-item" href="../articles/the_dpr2_workflow.html">The DPR2 Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/data_documentation.html">Data Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/data_versioning.html">Data Versioning</a></li>
    <li><a class="dropdown-item" href="../articles/datapackager_compatibility.html">DataPackageR Compatibility</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The DPR2 Workflow</h1>
            
      

      <div class="d-none name"><code>the_dpr2_workflow.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates the DPR2 workflow for building data
packages. We will go over key DPR2 functions and how to build a data
package from start to finish.</p>
<div class="section level2">
<h2 id="dpr2-workflow-overview">DPR2 workflow overview<a class="anchor" aria-label="anchor" href="#dpr2-workflow-overview"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Create a folder with the name of the new data package.</li>
<li>Start an R session with that folder set as the working
directory.</li>
<li>Load the DPR2 library with <code><a href="https://fredhutch.github.io/DPR2/">library(DPR2)</a></code>
</li>
<li>Initialize the data package with <code><a href="../reference/dpr_init.html">dpr_init()</a></code>
</li>
<li>Add any necessary source data to the folder
<code>inst/extdata</code>
</li>
<li>Add your processing scripts to the folder
<code>processing</code>
</li>
<li>Build the data package with <code><a href="../reference/dpr_build.html">dpr_build()</a></code>
</li>
</ol>
<p>In this workflow, processing scripts are written to transform source
data into analysis data. Static vignettes and documentation are rendered
from those scripts, and any data that is generated can be saved to the
package using <code><a href="../reference/dpr_save.html">dpr_save()</a></code>.</p>
<div class="section level3">
<h3 id="the-dpr2-yaml-and-api">The DPR2 YAML and API<a class="anchor" aria-label="anchor" href="#the-dpr2-yaml-and-api"></a>
</h3>
<p>DPR2 was designed so that any package building behavior
configurations can be stored in a package’s
<code>datapackager.yml</code> file that lives at the data package
source’s root directory. This file is generated when the data package is
initialized and is maintained by the user. The DPR2 API is designed
around this concept, much like the original DataPackageR; however, DPR2
also allows for changing the values in that file in an adhoc fashion by
using the ellipsis operator in all its function calls that access the
values in the configuration YAML file.</p>
</div>
<div class="section level3">
<h3 id="initializing-a-dpr2-package">Initializing a DPR2 package<a class="anchor" aria-label="anchor" href="#initializing-a-dpr2-package"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fredhutch.github.io/DPR2/">DPR2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dpr_init.html">dpr_init</a></span><span class="op">(</span>yaml <span class="op">=</span> <span class="fu"><a href="../reference/dpr_yaml_init.html">dpr_yaml_init</a></span><span class="op">(</span>process_on_build <span class="op">=</span> <span class="st">'my_process.Rmd'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>There are two ways one can initialize a new DPR2 package: using
<code>dpr_init</code> or <code>dpr_create</code>. <code>dpr_init</code>
is simply a wrapper of <code>dpr_create</code>, where
<code>dpr_init</code> will create a new DPR2 package at the current
working directory, and <code>dpr_create</code> will create a new DPR2
package at a specified path. When the package is initialized, DPR2 will
check if any necessary files it needs are already present and create
those if they are missing. This functionality is handy when a package
already exists and a user would like to maintain that package using
DPR2.</p>
<p>The DPR2 package <code>datapackager.yml</code> and
<code>DESCRIPTION</code> files can be initialized with specific values
using the <code>yaml</code> and <code>desc</code> arguments. The
arguments passed are named lists that are generated using the
<code><a href="../reference/dpr_yaml_init.html">dpr_yaml_init()</a></code> and <code><a href="../reference/dpr_description_init.html">dpr_description_init()</a></code>
function calls, which are used to generate each configuration file
respectively. These functions will add any necessary key value pairs
that are required but not enumerated by the user to ensure the resulting
files are valid. For a list of default values for each of these, see
<code><a href="../reference/dpr_yaml_defaults.html">?dpr_yaml_defaults</a></code> and
<code><a href="../reference/dpr_description_defaults.html">?dpr_description_defaults</a></code>.</p>
</div>
<div class="section level3">
<h3 id="building-a-dpr2-package">Building a DPR2 package<a class="anchor" aria-label="anchor" href="#building-a-dpr2-package"></a>
</h3>
<p>Before a package is built, a processing script must be added to the
<code>processing</code> directory.</p>
<div class="section level4">
<h4 id="adding-an-example-processing-script">Adding an example processing script<a class="anchor" aria-label="anchor" href="#adding-an-example-processing-script"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/dpr_path.html">dpr_path</a></span><span class="op">(</span><span class="st">'processing'</span>, <span class="st">'my_process.Rmd'</span><span class="op">)</span></span>
<span>  <span class="op">)</span>, sep <span class="op">=</span> <span class="st">'\n'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; title: example processing script</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Example text</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```{r}</span></span>
<span><span class="co">#&gt; library(DPR2)</span></span>
<span><span class="co">#&gt; my_df &lt;- data.frame(a = 1:5, b = letters[1:5])</span></span>
<span><span class="co">#&gt; dpr_save('my_df')</span></span>
<span><span class="co">#&gt; ```</span></span></code></pre>
<p><code><a href="../reference/dpr_path.html">dpr_path()</a></code> is used to refer to other paths within
processing scripts and <code><a href="../reference/dpr_save.html">dpr_save()</a></code> to save objects to the
<code>data</code> directory. Objects saved this way always follow DPR2
best practices, including saving as single-object <code>rda</code>
files.</p>
<p>Once a script is added to the processing directory, DPR2 must know
that it is a script the user wants processed when the package is
built.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dpr_add_scripts.html">dpr_add_scripts</a></span><span class="op">(</span><span class="st">"my_process.Rmd"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="dpr_build-and-dpr_render">
<code>dpr_build</code> and <code>dpr_render</code><a class="anchor" aria-label="anchor" href="#dpr_build-and-dpr_render"></a>
</h4>
<p><code>dpr_build</code> and <code>dpr_render</code> are the functions
used for building a data package from processing scripts.
<code>dpr_build</code> wraps <code>dpr_render</code> but in addition may
do the following:</p>
<ul>
<li>save the rendered processing scripts to vignettes in the data
package source</li>
<li>update the data digest with new checksums</li>
<li>build the package tarball</li>
<li>install the package in the current R environment</li>
</ul>
<p><code>dpr_render</code> can be used before <code>dpr_build</code> if
the user doesn’t immediately want to build the package, but instead is
interested in checking if the package can be built successfully or if
the associated vignettes are rendered correctly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dpr_render.html">dpr_render</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In the above example, this call to <code>dpr_render</code> makes use
of the ellipsis operator, temporarily overriding the value for
<code>process_on_build</code> in the <code>datapackager.yml</code>
file.</p>
</div>
<div class="section level4">
<h4 id="build-the-data-package">Build the data package<a class="anchor" aria-label="anchor" href="#build-the-data-package"></a>
</h4>
<p>After checking if <code>dpr_render</code> renders the processing
scripts without error, <code>dpr_build</code> can be used to build and
install the package. Users also can choose to skip rendering and build
the package as is.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dpr_build.html">dpr_build</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># examine data directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "my_df.rda"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="examine-the-data-digest">Examine the data digest<a class="anchor" aria-label="anchor" href="#examine-the-data-digest"></a>
</h4>
<p>As mentioned in <a href="dpr2_introduction.html">Introduction to
DPR2</a>, the data digest is formatted as a directory of files. Each of
these files contains the md5 checksum of the objects loaded from data in
memory. This manner of hashing is consistent with the original
DataPackageR. The digest can be viewed at any time as a single file
using <code><a href="../reference/dpr_data_digest.html">dpr_data_digest()</a></code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dpr_data_digest.html">dpr_data_digest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        name                  data_digest_md5</span></span>
<span><span class="co">#&gt; 1 my_df.rda ac3f4afc00920b7b099f2051a48956b1</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="examine-the-saved-data-object">Examine the saved data object<a class="anchor" aria-label="anchor" href="#examine-the-saved-data-object"></a>
</h4>
<p>Once a package is built it can be installed and its packaged data and
vignettes can be accessed using <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code> and
<code><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette()</a></code> base functions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'my_df'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"my_data_package"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="using-git">Using Git<a class="anchor" aria-label="anchor" href="#using-git"></a>
</h2>
<p>It is highly recommended that git be used alongside DPR2. Git version
control allows users to store versions of data and processing scripts in
a fashion that is easy to revert to and recall from. DPR2 was built to
allow parallel versions of an analysis to be merged together,
reconciling differences using git. DPR2 offers a handful of tools to
simplify recalling different versions of a dataset, which is explained
in the <a href="data_versioning.html">Data Versioning</a> vignette. To
learn about how to use git in general, see the free book <a href="https://git-scm.com/book/en/v2" class="external-link">Pro Git</a>.</p>
</div>
<div class="section level2">
<h2 id="using-renv">Using Renv<a class="anchor" aria-label="anchor" href="#using-renv"></a>
</h2>
<p>DPR2 may be initialized with renv for dependency version control, and
it is recommended to do so. DPR2 can help tackle problems of unstable
and non-reproducible environments by using renv after initializing a
DPR2 package. Once the data package is initialized with renv, renv will
make sure that when a dependency is installed by a user, it will use the
same version of that dependency when building the data package in the
future, and will inform users whether they need to install a particular
version of a package dependency. This is useful when having multiple
users collaborate on a data package, as it will ensure that the
dependency versions are the same across users. For more details on renv,
refer to the <a href="https://docs.posit.co/ide/user/ide/guide/environments/r/renv.html" class="external-link">renv
documentation</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jason Taylor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
